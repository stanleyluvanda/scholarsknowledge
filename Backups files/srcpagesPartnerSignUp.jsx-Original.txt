// src/pages/PartnerSignUp.jsx
import { useState } from "react";
import { useNavigate, Link } from "react-router-dom";

export default function PartnerSignUp() {
  const nav = useNavigate();
  const [form, setForm] = useState({
    orgName: "",
    contactName: "",
    email: "",
    password: "",
    agree: false,
  });
  const [err, setErr] = useState("");

  const onChange = (e) => {
    const { name, value, type, checked } = e.target;
    setForm((f) => ({ ...f, [name]: type === "checkbox" ? checked : value }));
  };

  const submit = (e) => {
    e.preventDefault();
    setErr("");

    if (!form.orgName || !form.contactName || !form.email || !form.password) {
      setErr("Please complete all fields.");
      return;
    }
    if (!form.agree) {
      setErr("Please agree to the partnership terms.");
      return;
    }

    // store in localStorage (demo only; replace with real backend later)
    const partners = JSON.parse(localStorage.getItem("partners") || "[]");
    if (partners.find((p) => p.email.toLowerCase() === form.email.toLowerCase())) {
      setErr("An account with this email already exists. Please log in.");
      return;
    }
    const user = {
      id: "p_" + Date.now(),
      orgName: form.orgName,
      contactName: form.contactName,
      email: form.email,
      // NOTE: do NOT store plaintext passwords in production
      password: form.password,
    };
    localStorage.setItem("partners", JSON.stringify([user, ...partners]));
    localStorage.setItem("partnerAuth", JSON.stringify(user));

    nav("/partner/welcome", { replace: true });
  };

  return (
    <div className="max-w-xl mx-auto px-4 py-10">
      <h1 className="text-2xl font-bold">Partner Sign Up</h1>
      <p className="mt-1 text-slate-600">
        Create an account to list scholarships on ScholarsKnowledge.
      </p>

      {err && (
        <div className="mt-4 p-3 rounded bg-red-50 border border-red-200 text-red-700">
          {err}
        </div>
      )}

      <form onSubmit={submit} className="mt-6 space-y-4">
        <label className="block">
          <div className="text-sm font-medium">Organization / University *</div>
          <input
            name="orgName"
            value={form.orgName}
            onChange={onChange}
            className="mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm"
            placeholder="e.g., University of Example"
          />
        </label>

        <label className="block">
          <div className="text-sm font-medium">Contact Person *</div>
          <input
            name="contactName"
            value={form.contactName}
            onChange={onChange}
            className="mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm"
            placeholder="Full name"
          />
        </label>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label className="block">
            <div className="text-sm font-medium">Email *</div>
            <input
              type="email"
              name="email"
              value={form.email}
              onChange={onChange}
              className="mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm"
              placeholder="you@org.edu"
            />
          </label>

          <label className="block">
            <div className="text-sm font-medium">Password *</div>
            <input
              type="password"
              name="password"
              value={form.password}
              onChange={onChange}
              className="mt-1 w-full border border-slate-300 rounded px-3 py-2 text-sm"
              placeholder="••••••••"
            />
          </label>
        </div>

        <label className="flex items-start gap-2">
          <input
            type="checkbox"
            name="agree"
            checked={form.agree}
            onChange={onChange}
            className="mt-1"
          />
          <span className="text-sm text-slate-700">
            I agree to the partnership requirements: no essays, no application fees,
            and no collection of confidential personal data (e.g., bank details, SSN).
          </span>
        </label>

        <div className="pt-2 flex items-center gap-3">
          <button className="rounded bg-blue-600 text-white px-4 py-2 text-sm font-semibold hover:bg-blue-700">
            Create Account
          </button>
          <span className="text-sm text-slate-600">
            Already have an account?{" "}
            <Link to="/partner/login" className="text-blue-700 underline">Log in</Link>
          </span>
        </div>
      </form>
    </div>
  );
}